<script setup lang="ts">
import axios from '@axios'
import { useRoute, useRouter } from 'vue-router'

const route = useRoute()
const router = useRouter()

const payment = ref()
let intervalId = ref()
let count = ref(0)

console.log(route.params.paymentId)

const getPayment = async () => {
  try {
    const response = await axios.get(`/v1/payment/${route.params.paymentId}`)
    payment.value = response.data
    count.value = unref(count) + 1
  } catch (error) {
    clearInterval(intervalId.value)
    router.push({
      path: `/apps/pricings`,
      query: {
        status: 'failed',
      },
    })
  }
}

const paymentIntervalInit = () => {
  intervalId.value = window.setInterval(() => {
    getPayment()
  }, 3000)
}

paymentIntervalInit()

watch(
  () => unref(payment),
  (value) => {
    if (unref(payment)?.status !== 0) {
      clearInterval(intervalId.value)
    }
    if (unref(payment)?.status === 1)
      router.push({
        path: `/apps/pricings`,
        query: {
          status: 'success',
        },
      })

    if (unref(payment)?.status === 2) {
      router.push({
        path: `/apps/pricings`,
        query: {
          status: 'failed',
        },
      })
    }
  }
)

watch(
  () => unref(count),
  (_) => {
    if (unref(count) >= 3) {
      clearInterval(intervalId.value)

      router.push({
        path: `/apps/pricings`,
        query: {
          status: 'failed',
        },
      })
    }
  }
)
</script>

<template>
  <div class="layout-wrapper layout-blank">
    <div class="misc-wrapper">
      <div class="text-center mb-12">
        <!-- ðŸ‘‰ Title and subtitle -->
        <h1 class="text-h1 font-weight-medium mb-3">Payment Processing ðŸš§</h1>
        <p>Please wait until payment has been processed</p>
      </div>
      <VProgressCircular class="mb-2" size="80" indeterminate color="primary">
        <!-- ðŸ‘‰ Image -->
        <svg
          version="1.1"
          id="Layer_1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          x="0px"
          y="0px"
          width="40"
          viewBox="0 0 163 144"
          enable-background="new 0 0 163 144"
          xml:space="preserve"
        >
          <path
            fill="#24DBDB"
            opacity="1.000000"
            stroke="none"
            d="
M1.000000,73.000000 
	C1.000000,55.979103 1.000000,38.958210 1.259233,21.802959 
	C1.979704,21.222889 2.654077,20.862032 2.870361,20.318794 
	C6.376615,11.512137 12.425793,5.469583 21.624464,2.719937 
	C21.896692,2.638563 21.881294,1.594965 22.000000,1.000000 
	C36.687561,1.000000 51.375122,1.000000 66.729675,1.366150 
	C72.813461,2.508322 78.307793,2.937020 83.632469,4.125677 
	C99.420830,7.650207 111.316574,15.969169 114.360039,32.813267 
	C117.521675,50.311409 115.725418,66.743813 100.231949,78.718170 
	C89.506104,87.007812 87.697479,96.826401 94.890648,108.326202 
	C102.553093,120.576248 110.293587,132.777466 118.000000,145.000000 
	C116.611107,145.000000 115.222221,145.000000 113.785751,144.756149 
	C112.705299,143.758575 111.764977,142.801285 110.625076,142.282944 
	C100.451164,137.656769 90.205055,133.188400 80.052155,128.517166 
	C65.613319,121.874046 51.479481,114.495430 36.766323,108.540443 
	C20.337507,101.891060 8.402682,91.525970 2.930045,74.354431 
	C2.740104,73.758461 1.663395,73.445091 1.000000,73.000000 
M83.015640,67.752220 
	C84.883904,68.342964 86.752174,68.933708 88.789017,69.577751 
	C88.934181,70.973564 89.084335,72.417328 89.237450,73.889549 
	C99.706306,71.164055 106.190491,62.996651 105.927010,53.055473 
	C105.711464,44.922405 100.370934,38.502178 92.741371,37.204086 
	C85.510139,35.973766 78.067192,40.056915 75.311333,46.766087 
	C72.114540,54.548744 74.772026,62.329006 83.015640,67.752220 
M41.146862,63.218861 
	C44.779640,65.596924 48.412418,67.974991 52.917130,70.923836 
	C52.923809,70.985046 53.080978,72.425140 53.368782,75.062248 
	C57.317730,72.379173 61.081921,70.525177 63.925152,67.733276 
	C68.806137,62.940414 70.696999,56.838394 69.309235,49.956928 
	C67.962830,43.280605 64.008652,38.892391 57.360115,37.446030 
	C50.792618,36.017296 45.046734,37.954834 41.111000,43.498108 
	C36.754238,49.634373 36.683399,56.142296 41.146862,63.218861 
z"
          />
          <path
            fill="#333333"
            opacity="1.000000"
            stroke="none"
            d="
M118.468658,145.000000 
	C110.293587,132.777466 102.553093,120.576248 94.890648,108.326202 
	C87.697479,96.826401 89.506104,87.007812 100.231949,78.718170 
	C115.725418,66.743813 117.521675,50.311409 114.360039,32.813267 
	C111.316574,15.969169 99.420830,7.650207 83.632469,4.125677 
	C78.307793,2.937020 72.813461,2.508322 67.198334,1.366150 
	C85.687561,1.000000 104.375122,1.000000 123.601074,1.372953 
	C125.312737,2.174753 126.457748,2.718802 127.663635,3.014772 
	C140.952530,6.276343 153.382309,10.846029 156.546997,30.188599 
	C158.705322,43.380253 154.459351,59.583694 140.223145,65.938652 
	C139.310074,66.346245 138.571762,67.145317 137.335266,68.076088 
	C149.409286,72.564713 157.809464,80.013802 162.173813,91.647873 
	C162.397125,92.243164 163.373993,92.555771 164.000000,93.000000 
	C164.000000,103.354225 164.000000,113.708458 163.643616,124.582405 
	C159.985992,130.103012 156.890152,135.258911 153.287735,140.032516 
	C151.731049,142.095276 149.127823,143.368256 147.000000,145.000000 
	C137.645767,145.000000 128.291550,145.000000 118.468658,145.000000 
z"
          />
          <path
            fill="#24DCDC"
            opacity="1.000000"
            stroke="none"
            d="
M100.000000,145.000000 
	C73.312439,145.000000 46.624878,145.000000 19.802998,144.745728 
	C12.109114,140.027359 5.697980,134.495911 2.385311,126.038452 
	C2.319541,125.870529 1.479049,126.006050 1.000000,126.000000 
	C1.000000,118.979050 1.000000,111.958107 1.298783,104.814415 
	C4.044958,104.270691 6.713006,103.026443 8.891103,103.610214 
	C12.729657,104.639038 16.267584,106.787086 19.934130,108.460510 
	C46.622364,120.641190 73.311295,132.820358 100.000000,145.000000 
z"
          />
          <path
            fill="#000000"
            opacity="0.000000"
            stroke="none"
            d="
M164.000000,92.531342 
	C163.373993,92.555771 162.397125,92.243164 162.173813,91.647873 
	C157.809464,80.013802 149.409286,72.564713 137.335266,68.076088 
	C138.571762,67.145317 139.310074,66.346245 140.223145,65.938652 
	C154.459351,59.583694 158.705322,43.380253 156.546997,30.188599 
	C153.382309,10.846029 140.952530,6.276343 127.663635,3.014772 
	C126.457748,2.718802 125.312737,2.174753 124.069733,1.372953 
	C137.288986,1.000000 150.577988,1.000000 164.000000,1.000000 
	C164.000000,31.354109 164.000000,61.708397 164.000000,92.531342 
z"
          />
          <path
            fill="#000000"
            opacity="0.000000"
            stroke="none"
            d="
M100.463181,145.000000 
	C73.311295,132.820358 46.622364,120.641190 19.934130,108.460510 
	C16.267584,106.787086 12.729657,104.639038 8.891103,103.610214 
	C6.713006,103.026443 4.044958,104.270691 1.298783,104.345840 
	C1.000000,93.979103 1.000000,83.958214 1.000000,73.468658 
	C1.663395,73.445091 2.740104,73.758461 2.930045,74.354431 
	C8.402682,91.525970 20.337507,101.891060 36.766323,108.540443 
	C51.479481,114.495430 65.613319,121.874046 80.052155,128.517166 
	C90.205055,133.188400 100.451164,137.656769 110.625076,142.282944 
	C111.764977,142.801285 112.705299,143.758575 113.369087,144.756149 
	C108.975456,145.000000 104.950912,145.000000 100.463181,145.000000 
z"
          />
          <path
            fill="#000000"
            opacity="0.000000"
            stroke="none"
            d="
M21.531088,1.000000 
	C21.881294,1.594965 21.896692,2.638563 21.624464,2.719937 
	C12.425793,5.469583 6.376615,11.512137 2.870361,20.318794 
	C2.654077,20.862032 1.979704,21.222889 1.259233,21.334301 
	C1.000000,14.405403 1.000000,7.810807 1.000000,1.000000 
	C7.685847,1.000000 14.374011,1.000000 21.531088,1.000000 
z"
          />
          <path
            fill="#000000"
            opacity="0.000000"
            stroke="none"
            d="
M1.000000,126.469376 
	C1.479049,126.006050 2.319541,125.870529 2.385311,126.038452 
	C5.697980,134.495911 12.109114,140.027359 19.334339,144.745728 
	C13.072124,145.000000 7.144247,145.000000 1.000000,145.000000 
	C1.000000,138.981293 1.000000,132.960022 1.000000,126.469376 
z"
          />
          <path
            fill="#000000"
            opacity="0.000000"
            stroke="none"
            d="
M147.470459,145.000000 
	C149.127823,143.368256 151.731049,142.095276 153.287735,140.032516 
	C156.890152,135.258911 159.985992,130.103012 163.643616,125.051064 
	C164.000000,131.586136 164.000000,138.172272 164.000000,145.000000 
	C158.649368,145.000000 153.295135,145.000000 147.470459,145.000000 
z"
          />
          <path
            fill="#010404"
            opacity="1.000000"
            stroke="none"
            d="
M82.683380,67.564285 
	C74.772026,62.329006 72.114540,54.548744 75.311333,46.766087 
	C78.067192,40.056915 85.510139,35.973766 92.741371,37.204086 
	C100.370934,38.502178 105.711464,44.922405 105.927010,53.055473 
	C106.190491,62.996651 99.706306,71.164055 89.237450,73.889549 
	C89.084335,72.417328 88.934181,70.973564 88.789017,69.577751 
	C86.752174,68.933708 84.883904,68.342964 82.683380,67.564285 
z"
          />
          <path
            fill="#010404"
            opacity="1.000000"
            stroke="none"
            d="
M40.938690,62.904419 
	C36.683399,56.142296 36.754238,49.634373 41.111000,43.498108 
	C45.046734,37.954834 50.792618,36.017296 57.360115,37.446030 
	C64.008652,38.892391 67.962830,43.280605 69.309235,49.956928 
	C70.696999,56.838394 68.806137,62.940414 63.925152,67.733276 
	C61.081921,70.525177 57.317730,72.379173 53.368782,75.062248 
	C53.080978,72.425140 52.923809,70.985046 52.917130,70.923836 
	C48.412418,67.974991 44.779640,65.596924 40.938690,62.904419 
z"
          />
        </svg>
      </VProgressCircular>
    </div>
  </div>
</template>

<style lang="scss">
@use '@core/scss/template/pages/misc.scss';
</style>

<route lang="yaml">
meta:
  layout: blank
  public: true
  action: read
  subject: Auth
</route>
